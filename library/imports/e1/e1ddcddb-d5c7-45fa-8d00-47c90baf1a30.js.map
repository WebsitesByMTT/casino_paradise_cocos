{"version":3,"sources":["assets/Scripts/GamesPrefab.js"],"names":["cc","Class","Component","properties","imageView","Sprite","imageClick","Button","addToFavouirteButton","mywebView","WebView","webviewUrl","lobbyNode","redHeart","type","Node","blueHeart","loader","aniMation","delayDuration","Float","onLoad","setupEventListeners","find","getComponent","startLoaderAnimation","_tween","stop","tween","repeatForever","to","angle","start","stopLoaderAnimation","node","off","onTouchStart","onTouchEnd","onTouchCancel","on","updateItem","data","gameCategory","inst","myData","active","assetManager","loadRemote","thumbnail","err","texture","console","error","spriteFrame","SpriteFrame","event","touchEndPos","getLocation","distance","sub","touchStartPos","mag","onClickItem","interactable","slug","undefined","addToFavouirte","address","K","ServerAddress","ipAddress","ServerAPI","getGameById","ServerCom","httpRequest","response","url","openWebView","bind","userData","gameId","_id","addtoFav","id","errorHeading","string","errorLable","message","loginErrorNode","setTimeout","category","fetchGames"],"mappings":"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","sourceRoot":"/","sourcesContent":["\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        imageView: cc.Sprite,\n        imageClick: cc.Button,\n        addToFavouirteButton: cc.Button,\n        mywebView: cc.WebView,\n        webviewUrl: null,\n        lobbyNode: null,\n        redHeart:{\n            default: null,\n            type: cc.Node\n        },\n        blueHeart:{\n            default: null,\n            type: cc.Node\n        },\n        loader:{\n            default: null,\n            type: cc.Node\n        },\n        aniMation: {\n            default: null,\n            type: cc.Node\n        },\n        delayDuration: {\n            default: 2,\n            type: cc.Float\n        }\n    },\n\n    onLoad() {\n        this.setupEventListeners();\n        const lobbyNode = cc.find(\"Canvas/LobbyNode\");\n        if (lobbyNode) {\n            this.lobbyNode = lobbyNode.getComponent(\"Lobby\");\n            if (!this.lobbyNode) {\n                // console.error(\"Lobby component not found on LobbyNode\");\n            }\n        } else {\n            // console.error(\"LobbyNode not found in the scene\");\n        }\n        this.startLoaderAnimation();\n    },\n\n    startLoaderAnimation() {\n        if (this.aniMation._tween) {\n            this.aniMation._tween.stop();\n        }\n        this.aniMation._tween = cc.tween(this.aniMation).repeatForever(cc.tween().to(1, { angle: -360 })).start();\n    },\n\n    stopLoaderAnimation() {\n        if (this.aniMation._tween) {\n            this.aniMation._tween.stop();\n            this.aniMation.angle = 0;\n        }\n    },\n\n    setupEventListeners() {\n        // // Add new listeners\n        // this.imageClick.node.on('click', this.onClickItem, this);\n        // this.addToFavouirteButton.node.on('click', this.addToFavouirte, this);\n            // Remove existing listeners to prevent duplicate event calls\n            this.imageClick.node.off('touchstart', this.onTouchStart, this);\n            this.imageClick.node.off('touchend', this.onTouchEnd, this);\n            this.imageClick.node.off('touchcancel', this.onTouchCancel, this);\n    \n            // Add new listeners\n            this.imageClick.node.on('touchstart', this.onTouchStart, this);\n            this.imageClick.node.on('touchend', this.onTouchEnd, this);\n            this.imageClick.node.on('touchcancel', this.onTouchCancel, this);\n    },\n\n    updateItem(data, gameCategory) {\n        let inst = this\n        let myData = data;\n\n        if (!inst.loader.active) {\n            inst.loader.active = true;\n        }\n        cc.assetManager.loadRemote(data.thumbnail, (err, texture) => {\n                if (err) {\n                    console.error(err);\n                    if (this.loader) {\n                        this.loader.active = false;\n                    }\n                    return;\n                }\n                this.imageView.spriteFrame = new cc.SpriteFrame(texture);\n                // Hide the loader\n                if (this.loader) {\n                    this.loader.active = false;\n                }\n        });\n    \n        if(gameCategory == \"fav\"){\n            this.blueHeart.active = false;\n            this.redHeart.active = true;\n        }\n        if(this.loader){\n            this.loader.active = false;\n        }\n\n        // Update click listeners with new data\n        this.imageClick.node.off('click');\n        this.addToFavouirteButton.node.off('click');\n\n        this.imageClick.node.on('touchend', (event) => {\n            let touchEndPos = event.getLocation();\n            let distance = touchEndPos.sub(this.touchStartPos).mag();\n            if (distance < 10) { // Adjust this threshold as needed\n                this.onClickItem(data);\n            }\n            this.imageClick.node.interactable = false;\n        });\n        this.addToFavouirteButton.node.on('click', () => {\n            if(myData.slug == undefined){\n                return\n            }\n            else{\n                this.addToFavouirte(myData);\n                this.addToFavouirteButton.node.interactable = false;\n            }\n        });\n    },\n\n    onTouchStart(event) {\n        this.touchStartPos = event.getLocation();\n    },\n\n    onTouchEnd(event) {\n        let touchEndPos = event.getLocation();\n        let distance = touchEndPos.sub(this.touchStartPos).mag();\n        if (distance < 10) { // Adjust this threshold as needed\n            // this.onClickItem(this.data);\n        }\n    },\n\n    onTouchCancel(event) {\n        this.touchStartPos = null;\n    },\n\n    //Prefab Clicke to open the game\n    onClickItem(data) {\n        let inst = this;\n        if (data.slug == undefined) {\n            return;\n        }\n        let address = K.ServerAddress.ipAddress + K.ServerAPI.getGameById + `/${data.slug}`;\n        ServerCom.httpRequest(\"GET\", address, \"\", function(response) {\n            if (response.url == undefined) {\n                return;\n            }\n            let webviewUrl = response.url;\n            if (inst.lobbyNode) {\n                inst.lobbyNode.openWebView(webviewUrl);\n            }\n        }.bind(this));\n    },\n\n    addToFavouirte(myData) {\n        let inst = this\n        if (myData.slug == undefined) {\n            return;\n        } else {\n            let userData = {\n                gameId: myData._id,\n                type: inst.blueHeart.active ? \"add\" : \"remove\"\n            };\n            let address = K.ServerAddress.ipAddress + K.ServerAPI.addtoFav + `/${this.lobbyNode.id}`;\n            // console.log(this.lobbyNode.id, \"check user Id\");\n            ServerCom.httpRequest(\"PUT\", address, userData, function(response) {\n                // console.log(\"response\", response);\n                ServerCom.errorHeading.string = \"Success\";\n                ServerCom.errorLable.string = response.message\n                if(response.message == \"Game added to favourites\"){\n                    inst.redHeart.active = true;\n                    inst.blueHeart.active = false;\n                }else{\n                    inst.blueHeart.active = true;\n                    inst.redHeart.active = false;\n                }\n                ServerCom.loginErrorNode.active = true;\n                setTimeout(() => {\n                    ServerCom.loginErrorNode.active = false;\n                }, 2000);\n                if (inst.lobbyNode && inst.lobbyNode.category == \"fav\") {\n                    inst.lobbyNode.fetchGames(\"fav\");\n                }\n                   \n            }.bind(this));\n        }\n    },\n});"]}