{"version":3,"sources":["assets/Scripts/ServerCom.js"],"names":["root","window","cc","Class","Component","properties","loading","type","Node","reconnecting","tracker","errorLable","Label","loginErrorNode","errorHeading","loaderAnimNode","trackerCount","timer","onLoad","ServerCom","checkOrientation","view","on","sys","isMobile","isBrowser","console","log","winSize","width","height","setOrientation","macro","ORIENTATION_LANDSCAPE","ORIENTATION_PORTRAIT","error","clearTracker","httpRequest","method","address","data","callback","timeout","inst","xhr","XMLHttpRequest","active","startLoaderAnimation","onreadystatechange","K","internetAvailable","readyState","stopLoaderAnimation","response","responseText","status","undefined","JSON","parse","errorMsg","errorData","string","message","setTimeout","e","onerror","err","ontimeout","disconnectRequestedByPlayer","open","setRequestHeader","token","cookies","document","cookie","split","i","length","trim","startsWith","substring","os","OS_ANDROID","Os_IOS","localStorage","getItem","send","stringify","_tween","stop","tween","repeatForever","to","angle","start"],"mappings":"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","sourceRoot":"/","sourcesContent":["// const axios = require('axios')\nvar root = window;\ncc.Class({\n    extends: cc.Component,\n    properties: {\n        loading: {\n            default: null,\n            type: cc.Node,\n        },\n        reconnecting: {\n            default: null,\n            type: cc.Node,\n        },\n        tracker: {\n            default: {},\n        },\n        errorLable:{\n            default: null,\n            type:cc.Label\n        },\n        loginErrorNode:{\n            default: null,\n            type: cc.Node\n        },\n        errorHeading:{\n            default: null,\n            type: cc.Label\n        },\n        loaderAnimNode:{\n            default: null,\n            type: cc.Node\n        },\n        trackerCount: 0,\n        timer : 0,\n    },\n    // LIFE-CYCLE CALLBACKS:\n    onLoad() {\n        // Created ServerCom Gloabaly so that we can access it anywhere we want\n        root.ServerCom = this;\n        this.checkOrientation();\n        // Add event listener for canvas resize to handle orientation change\n        cc.view.on('canvas-resize', this.checkOrientation, this);\n\n        if (cc.sys.isMobile && cc.sys.isBrowser) {\n            console.log = function() {};\n        }\n    },\n    // following function is to check the width and change the orientation(Landscape/Potrait) for mobile or dekstop\n    checkOrientation() {\n        try {\n            let winSize = cc.winSize;\n            // Check if the width is greater than the height to determine orientation\n            if (winSize.width > winSize.height) {\n                cc.view.setOrientation(cc.macro.ORIENTATION_LANDSCAPE);\n            } else {\n                cc.view.setOrientation(cc.macro.ORIENTATION_PORTRAIT);\n            }\n        } catch (error) {\n            // console.error(\"Error checking orientation:\", error);\n        }\n    },\n    clearTracker: function(){\n        this.trackerCount = 0;\n        this.tracker = {};\n    },\n\n    /**\n     * @method httpPostRequest\n     * @description HTTP request - POST data \n     * @param {String} address -address of Server \n     * @param {Object} data -Data/PayLoad to be sent\n     * @param {method} callback -Callback to be executed if response.succss is true!\n     * @param {method} error -Callback to be executed if response.success is false!\n     * @param {Number} timeout -value in milli seconds, Specify request timeout time! \n     * @memberof Utilities.ServerCom#\n     */\n\n    httpRequest: function (method, address, data, callback, error, timeout) {\n        var inst = this;\n        var xhr = new XMLHttpRequest();\n        xhr.timeout = timeout || 8000;\n        if(!ServerCom.loading.active){\n            ServerCom.loading.active = true;\n            inst.startLoaderAnimation();\n        }\n        xhr.onreadystatechange = function () {\n            K.internetAvailable = true;\n            if (xhr.readyState == 4) {\n                ServerCom.loading.active = false;\n                inst.stopLoaderAnimation();\n                var response = xhr.responseText;\n                if (xhr.status >= 200 && xhr.status < 400) {\n                    if (callback !== null && callback !== undefined) {\n                        var data = JSON.parse(response);\n                            callback(data);\n                    }\n                } else {\n                    var errorMsg = \"Unknown error\";\n                    try {\n                        var errorData = JSON.parse(response);\n                        if (errorData.error) {\n                            errorMsg = errorData.error;\n                        }\n                        // console.log(\"errorDataerrorData\", errorData, xhr);\n                        inst.errorLable.string = errorData.error ? errorData.error : errorData.message;\n                        inst.loginErrorNode.active = true;\n                        setTimeout(() => {\n                            inst.loginErrorNode.active = false;\n                        }, 2000);\n                        // callback(errorData);\n                    } catch (e) {\n                        // console.log(\"Error parsing error response:\", e);\n                    }\n                }\n            }\n        };\n    \n        xhr.onerror = function (err) {\n            ServerCom.loading.active = false;\n            inst.stopLoaderAnimation();\n            K.internetAvailable = false;\n            var errorMsg = \"Unknown error\";\n            try {\n                // console.log(\"xhr on error\", xhr);\n                var errorData = JSON.parse(xhr.responseText);\n                if (errorData.error) {\n                    errorMsg = errorData.error;\n                }\n            } catch (e) {\n                // console.error(\"Error parsing error response:\", e);\n            }\n        };\n    \n        xhr.ontimeout = function () {\n            ServerCom.loading.active = false;\n            inst.stopLoaderAnimation();\n            K.disconnectRequestedByPlayer = false;\n            K.internetAvailable = false;\n            // \n            inst.errorLable.string = \"Something went wrong\",\n            inst.loginErrorNode.active = true;\n            setTimeout(() => {\n                inst.loginErrorNode.active = false;\n            }, 2000);\n        };\n        // \n        // xhr.withCredentials = true;\n        xhr.open(method, address, true);\n        xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n        let token = null;\n        if (!token && cc.sys.isBrowser) {\n            const cookies = document.cookie.split(';');\n            for (let i = 0; i < cookies.length; i++) {\n                const cookie = cookies[i].trim();\n                if (cookie.startsWith('userToken=')) {\n                    token = cookie.substring('userToken='.length, cookie.length);\n                    break;\n                }\n            }\n        }else{\n            if (cc.sys.os === cc.sys.OS_ANDROID || cc.sys.os == cc.sys.Os_IOS) {\n                // This is an Android device\n                console.error(\"Running on Android and IOS\");\n                token = cc.sys.localStorage.getItem('userToken');\n            }\n        }\n        // If token exists, add it to a custom header\n        if (token) {\n            // console.log(token, \"token\");\n            xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\n            // xhr.setRequestHeader(\"Cookie\", `userToken=${token}`);\n        }\n        if (method === \"POST\" || method === \"PUT\") {\n            xhr.send(JSON.stringify(data));\n        } else if (method === \"GET\") {\n            xhr.send();\n        }\n    },\n\n    startLoaderAnimation() {\n        if (this.loaderAnimNode._tween) {\n            this.loaderAnimNode._tween.stop();\n        }\n        this.loaderAnimNode._tween = cc.tween(this.loaderAnimNode)\n            .repeatForever(cc.tween().to(1, { angle: -360 }))\n            .start();\n    },\n\n    stopLoaderAnimation() {\n        if (this.loaderAnimNode._tween) {\n            this.loaderAnimNode._tween.stop();\n            this.loaderAnimNode.angle = 0;\n        }\n    }\n\n\n\n    \n    // WILL use the following code later to check if the same api is request untill we gets its response\n    // /**\n    // updateTracker: function (val, key, showLoading) {\n    //     var incr = val ? +1 : -1;\n    //     this.trackerCount = this.trackerCount + incr;\n    //     var isActive = val && showLoading;\n    //     if(!this.loading.active && showLoading){\n    //         this.loading.active = true; \n    //     }else if(this.loading.active && !showLoading) {\n    //         this.loading.active = false;\n    //     }\n    //     //this.loading.active = val && showLoading;\n    //     this.tracker[key] = val;\n    // },\n\n});"]}