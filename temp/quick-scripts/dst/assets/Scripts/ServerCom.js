
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Scripts/ServerCom.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'bd275iqnndLToBuUOYxMq3n', 'ServerCom');
// Scripts/ServerCom.js

"use strict";

// const axios = require('axios')
var root = window;
cc.Class({
  "extends": cc.Component,
  properties: {
    loading: {
      "default": null,
      type: cc.Node
    },
    reconnecting: {
      "default": null,
      type: cc.Node
    },
    tracker: {
      "default": {}
    },
    errorLable: {
      "default": null,
      type: cc.Label
    },
    loginErrorNode: {
      "default": null,
      type: cc.Node
    },
    errorHeading: {
      "default": null,
      type: cc.Label
    },
    trackerCount: 0,
    timer: 0
  },
  // LIFE-CYCLE CALLBACKS:
  onLoad: function onLoad() {
    // Created ServerCom Gloabaly so that we can access it anywhere we want
    root.ServerCom = this;
    this.checkOrientation(); // Add event listener for canvas resize to handle orientation change

    cc.view.on('canvas-resize', this.checkOrientation, this);
  },
  // following function is to check the width and change the orientation(Landscape/Potrait) for mobile or dekstop
  checkOrientation: function checkOrientation() {
    try {
      var winSize = cc.winSize; // Check if the width is greater than the height to determine orientation

      if (winSize.width > winSize.height) {
        cc.view.setOrientation(cc.macro.ORIENTATION_LANDSCAPE);
      } else {
        cc.view.setOrientation(cc.macro.ORIENTATION_PORTRAIT);
      }
    } catch (error) {
      console.error("Error checking orientation:", error);
    }
  },
  clearTracker: function clearTracker() {
    this.trackerCount = 0;
    this.tracker = {};
  },

  /**
   * @method httpPostRequest
   * @description HTTP request - POST data 
   * @param {String} address -address of Server 
   * @param {Object} data -Data/PayLoad to be sent
   * @param {method} callback -Callback to be executed if response.succss is true!
   * @param {method} error -Callback to be executed if response.success is false!
   * @param {Number} timeout -value in milli seconds, Specify request timeout time! 
   * @memberof Utilities.ServerCom#
   */
  httpRequest: function httpRequest(method, address, data, callback, error, timeout) {
    var inst = this;
    var xhr = new XMLHttpRequest();
    xhr.timeout = timeout || 4000;

    if (!ServerCom.loading.active) {
      ServerCom.loading.active = true;
    }

    xhr.onreadystatechange = function () {
      K.internetAvailable = true;

      if (xhr.readyState == 4) {
        ServerCom.loading.active = false;
        var response = xhr.responseText;

        if (xhr.status >= 200 && xhr.status < 400) {
          if (callback !== null && callback !== undefined) {
            var data = JSON.parse(response);
            callback(data);
          }
        } else {
          var errorMsg = "Unknown error";

          try {
            var errorData = JSON.parse(response);

            if (errorData.error) {
              errorMsg = errorData.error;
            }

            console.log("errorDataerrorData", errorData, xhr);
            inst.errorLable.string = errorData.error ? errorData.error : errorData.message;
            inst.loginErrorNode.active = true;
            setTimeout(function () {
              inst.loginErrorNode.active = false;
            }, 2000); // callback(errorData);
          } catch (e) {
            console.log("Error parsing error response:", e);
          }
        }
      }
    };

    xhr.onerror = function (err) {
      ServerCom.loading.active = false;
      K.internetAvailable = false;
      var errorMsg = "Unknown error";

      try {
        console.log("xhr on error", xhr);
        var errorData = JSON.parse(xhr.responseText);

        if (errorData.error) {
          errorMsg = errorData.error;
        }
      } catch (e) {
        console.error("Error parsing error response:", e);
      }
    };

    xhr.ontimeout = function () {
      ServerCom.loading.active = false;
      K.disconnectRequestedByPlayer = false;
      K.internetAvailable = false; // 

      inst.errorLable.string = "Something went wrong", inst.loginErrorNode.active = true;
      setTimeout(function () {
        inst.loginErrorNode.active = false;
      }, 2000);
    }; // 
    // xhr.withCredentials = true;


    xhr.open(method, address, true);
    xhr.setRequestHeader("Content-Type", "application/json");
    var token = null;

    if (!token && cc.sys.isBrowser) {
      var cookies = document.cookie.split(';');

      for (var i = 0; i < cookies.length; i++) {
        var cookie = cookies[i].trim();

        if (cookie.startsWith('userToken=')) {
          token = cookie.substring('userToken='.length, cookie.length);
          break;
        }
      }
    } // If token exists, add it to a custom header


    if (token) {
      console.log(token, "token");
      xhr.setRequestHeader("Authorization", "Bearer " + token); // xhr.setRequestHeader("Cookie", `userToken=${token}`);
    }

    if (method === "POST" || method === "PUT") {
      xhr.send(JSON.stringify(data));
    } else if (method === "GET") {
      xhr.send();
    }
  } // WILL use the following code later to check if the same api is request untill we gets its response
  // /**
  // updateTracker: function (val, key, showLoading) {
  //     var incr = val ? +1 : -1;
  //     this.trackerCount = this.trackerCount + incr;
  //     var isActive = val && showLoading;
  //     if(!this.loading.active && showLoading){
  //         this.loading.active = true; 
  //     }else if(this.loading.active && !showLoading) {
  //         this.loading.active = false;
  //     }
  //     //this.loading.active = val && showLoading;
  //     this.tracker[key] = val;
  // },

});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9TY3JpcHRzL1NlcnZlckNvbS5qcyJdLCJuYW1lcyI6WyJyb290Iiwid2luZG93IiwiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJsb2FkaW5nIiwidHlwZSIsIk5vZGUiLCJyZWNvbm5lY3RpbmciLCJ0cmFja2VyIiwiZXJyb3JMYWJsZSIsIkxhYmVsIiwibG9naW5FcnJvck5vZGUiLCJlcnJvckhlYWRpbmciLCJ0cmFja2VyQ291bnQiLCJ0aW1lciIsIm9uTG9hZCIsIlNlcnZlckNvbSIsImNoZWNrT3JpZW50YXRpb24iLCJ2aWV3Iiwib24iLCJ3aW5TaXplIiwid2lkdGgiLCJoZWlnaHQiLCJzZXRPcmllbnRhdGlvbiIsIm1hY3JvIiwiT1JJRU5UQVRJT05fTEFORFNDQVBFIiwiT1JJRU5UQVRJT05fUE9SVFJBSVQiLCJlcnJvciIsImNvbnNvbGUiLCJjbGVhclRyYWNrZXIiLCJodHRwUmVxdWVzdCIsIm1ldGhvZCIsImFkZHJlc3MiLCJkYXRhIiwiY2FsbGJhY2siLCJ0aW1lb3V0IiwiaW5zdCIsInhociIsIlhNTEh0dHBSZXF1ZXN0IiwiYWN0aXZlIiwib25yZWFkeXN0YXRlY2hhbmdlIiwiSyIsImludGVybmV0QXZhaWxhYmxlIiwicmVhZHlTdGF0ZSIsInJlc3BvbnNlIiwicmVzcG9uc2VUZXh0Iiwic3RhdHVzIiwidW5kZWZpbmVkIiwiSlNPTiIsInBhcnNlIiwiZXJyb3JNc2ciLCJlcnJvckRhdGEiLCJsb2ciLCJzdHJpbmciLCJtZXNzYWdlIiwic2V0VGltZW91dCIsImUiLCJvbmVycm9yIiwiZXJyIiwib250aW1lb3V0IiwiZGlzY29ubmVjdFJlcXVlc3RlZEJ5UGxheWVyIiwib3BlbiIsInNldFJlcXVlc3RIZWFkZXIiLCJ0b2tlbiIsInN5cyIsImlzQnJvd3NlciIsImNvb2tpZXMiLCJkb2N1bWVudCIsImNvb2tpZSIsInNwbGl0IiwiaSIsImxlbmd0aCIsInRyaW0iLCJzdGFydHNXaXRoIiwic3Vic3Ry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QUFZVyxLQUFaLEVBQW1CLE9BQW5CO0FBQ0ExQixNQUFBQSxHQUFHLENBQUN5QixnQkFBSixDQUFxQixlQUFyQixFQUFzQyxZQUFZQyxLQUFsRCxFQUZPLENBR1A7QUFDSDs7QUFDRCxRQUFJaEMsTUFBTSxLQUFLLE1BQVgsSUFBcUJBLE1BQU0sS0FBSyxLQUFwQyxFQUEyQztBQUN2Q00sTUFBQUEsR0FBRyxDQUFDc0MsSUFBSixDQUFTM0IsSUFBSSxDQUFDNEIsU0FBTCxDQUFlM0MsSUFBZixDQUFUO0FBQ0gsS0FGRCxNQUVPLElBQUlGLE1BQU0sS0FBSyxLQUFmLEVBQXNCO0FBQ3pCTSxNQUFBQSxHQUFHLENBQUNzQyxJQUFKO0FBQ0g7QUFDSixHQS9KSSxDQW9LTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQWpMSyxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyIvLyBjb25zdCBheGlvcyA9IHJlcXVpcmUoJ2F4aW9zJylcbnZhciByb290ID0gd2luZG93O1xuY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIGxvYWRpbmc6IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXG4gICAgICAgICAgICB0eXBlOiBjYy5Ob2RlLFxuICAgICAgICB9LFxuICAgICAgICByZWNvbm5lY3Rpbmc6IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXG4gICAgICAgICAgICB0eXBlOiBjYy5Ob2RlLFxuICAgICAgICB9LFxuICAgICAgICB0cmFja2VyOiB7XG4gICAgICAgICAgICBkZWZhdWx0OiB7fSxcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3JMYWJsZTp7XG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsLFxuICAgICAgICAgICAgdHlwZTpjYy5MYWJlbFxuICAgICAgICB9LFxuICAgICAgICBsb2dpbkVycm9yTm9kZTp7XG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsLFxuICAgICAgICAgICAgdHlwZTogY2MuTm9kZVxuICAgICAgICB9LFxuICAgICAgICBlcnJvckhlYWRpbmc6e1xuICAgICAgICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICAgICAgICAgIHR5cGU6IGNjLkxhYmVsXG4gICAgICAgIH0sXG4gICAgICAgIHRyYWNrZXJDb3VudDogMCxcbiAgICAgICAgdGltZXIgOiAwLFxuICAgIH0sXG4gICAgLy8gTElGRS1DWUNMRSBDQUxMQkFDS1M6XG4gICAgb25Mb2FkKCkge1xuICAgICAgICAvLyBDcmVhdGVkIFNlcnZlckNvbSBHbG9hYmFseSBzbyB0aGF0IHdlIGNhbiBhY2Nlc3MgaXQgYW55d2hlcmUgd2Ugd2FudFxuICAgICAgICByb290LlNlcnZlckNvbSA9IHRoaXM7XG4gICAgICAgIHRoaXMuY2hlY2tPcmllbnRhdGlvbigpO1xuICAgICAgICAvLyBBZGQgZXZlbnQgbGlzdGVuZXIgZm9yIGNhbnZhcyByZXNpemUgdG8gaGFuZGxlIG9yaWVudGF0aW9uIGNoYW5nZVxuICAgICAgICBjYy52aWV3Lm9uKCdjYW52YXMtcmVzaXplJywgdGhpcy5jaGVja09yaWVudGF0aW9uLCB0aGlzKTtcbiAgICB9LFxuICAgIC8vIGZvbGxvd2luZyBmdW5jdGlvbiBpcyB0byBjaGVjayB0aGUgd2lkdGggYW5kIGNoYW5nZSB0aGUgb3JpZW50YXRpb24oTGFuZHNjYXBlL1BvdHJhaXQpIGZvciBtb2JpbGUgb3IgZGVrc3RvcFxuICAgIGNoZWNrT3JpZW50YXRpb24oKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBsZXQgd2luU2l6ZSA9IGNjLndpblNpemU7XG4gICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgd2lkdGggaXMgZ3JlYXRlciB0aGFuIHRoZSBoZWlnaHQgdG8gZGV0ZXJtaW5lIG9yaWVudGF0aW9uXG4gICAgICAgICAgICBpZiAod2luU2l6ZS53aWR0aCA+IHdpblNpemUuaGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgY2Mudmlldy5zZXRPcmllbnRhdGlvbihjYy5tYWNyby5PUklFTlRBVElPTl9MQU5EU0NBUEUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjYy52aWV3LnNldE9yaWVudGF0aW9uKGNjLm1hY3JvLk9SSUVOVEFUSU9OX1BPUlRSQUlUKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjaGVja2luZyBvcmllbnRhdGlvbjpcIiwgZXJyb3IpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBjbGVhclRyYWNrZXI6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMudHJhY2tlckNvdW50ID0gMDtcbiAgICAgICAgdGhpcy50cmFja2VyID0ge307XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgaHR0cFBvc3RSZXF1ZXN0XG4gICAgICogQGRlc2NyaXB0aW9uIEhUVFAgcmVxdWVzdCAtIFBPU1QgZGF0YSBcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gYWRkcmVzcyAtYWRkcmVzcyBvZiBTZXJ2ZXIgXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgLURhdGEvUGF5TG9hZCB0byBiZSBzZW50XG4gICAgICogQHBhcmFtIHttZXRob2R9IGNhbGxiYWNrIC1DYWxsYmFjayB0byBiZSBleGVjdXRlZCBpZiByZXNwb25zZS5zdWNjc3MgaXMgdHJ1ZSFcbiAgICAgKiBAcGFyYW0ge21ldGhvZH0gZXJyb3IgLUNhbGxiYWNrIHRvIGJlIGV4ZWN1dGVkIGlmIHJlc3BvbnNlLnN1Y2Nlc3MgaXMgZmFsc2UhXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHRpbWVvdXQgLXZhbHVlIGluIG1pbGxpIHNlY29uZHMsIFNwZWNpZnkgcmVxdWVzdCB0aW1lb3V0IHRpbWUhIFxuICAgICAqIEBtZW1iZXJvZiBVdGlsaXRpZXMuU2VydmVyQ29tI1xuICAgICAqL1xuXG4gXG4gICAgaHR0cFJlcXVlc3Q6IGZ1bmN0aW9uIChtZXRob2QsIGFkZHJlc3MsIGRhdGEsIGNhbGxiYWNrLCBlcnJvciwgdGltZW91dCkge1xuICAgICAgICBcbiAgICAgICAgdmFyIGluc3QgPSB0aGlzO1xuICAgICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgIHhoci50aW1lb3V0ID0gdGltZW91dCB8fCA0MDAwO1xuICAgICAgICBpZighU2VydmVyQ29tLmxvYWRpbmcuYWN0aXZlKXtcbiAgICAgICAgICAgIFNlcnZlckNvbS5sb2FkaW5nLmFjdGl2ZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIEsuaW50ZXJuZXRBdmFpbGFibGUgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09IDQpIHtcbiAgICAgICAgICAgICAgICBTZXJ2ZXJDb20ubG9hZGluZy5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSB4aHIucmVzcG9uc2VUZXh0O1xuICAgICAgICAgICAgICAgIGlmICh4aHIuc3RhdHVzID49IDIwMCAmJiB4aHIuc3RhdHVzIDwgNDAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPT0gbnVsbCAmJiBjYWxsYmFjayAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yTXNnID0gXCJVbmtub3duIGVycm9yXCI7XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JEYXRhID0gSlNPTi5wYXJzZShyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3JEYXRhLmVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNc2cgPSBlcnJvckRhdGEuZXJyb3I7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImVycm9yRGF0YWVycm9yRGF0YVwiLCBlcnJvckRhdGEsIHhocik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbnN0LmVycm9yTGFibGUuc3RyaW5nID0gZXJyb3JEYXRhLmVycm9yID8gZXJyb3JEYXRhLmVycm9yIDogZXJyb3JEYXRhLm1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbnN0LmxvZ2luRXJyb3JOb2RlLmFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0LmxvZ2luRXJyb3JOb2RlLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgMjAwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjYWxsYmFjayhlcnJvckRhdGEpO1xuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkVycm9yIHBhcnNpbmcgZXJyb3IgcmVzcG9uc2U6XCIsIGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIFxuICAgICAgICB4aHIub25lcnJvciA9IGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIFNlcnZlckNvbS5sb2FkaW5nLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgSy5pbnRlcm5ldEF2YWlsYWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgdmFyIGVycm9yTXNnID0gXCJVbmtub3duIGVycm9yXCI7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwieGhyIG9uIGVycm9yXCIsIHhocik7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yRGF0YSA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICAgICAgaWYgKGVycm9yRGF0YS5lcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBlcnJvck1zZyA9IGVycm9yRGF0YS5lcnJvcjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHBhcnNpbmcgZXJyb3IgcmVzcG9uc2U6XCIsIGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIFxuICAgICAgICB4aHIub250aW1lb3V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgU2VydmVyQ29tLmxvYWRpbmcuYWN0aXZlID0gZmFsc2U7XG4gICAgICAgICAgICBLLmRpc2Nvbm5lY3RSZXF1ZXN0ZWRCeVBsYXllciA9IGZhbHNlO1xuICAgICAgICAgICAgSy5pbnRlcm5ldEF2YWlsYWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgLy8gXG4gICAgICAgICAgICBpbnN0LmVycm9yTGFibGUuc3RyaW5nID0gXCJTb21ldGhpbmcgd2VudCB3cm9uZ1wiLFxuICAgICAgICAgICAgaW5zdC5sb2dpbkVycm9yTm9kZS5hY3RpdmUgPSB0cnVlO1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgaW5zdC5sb2dpbkVycm9yTm9kZS5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgIH0sIDIwMDApO1xuICAgICAgICB9O1xuICAgICAgICAvLyBcbiAgICAgICAgLy8geGhyLndpdGhDcmVkZW50aWFscyA9IHRydWU7XG4gICAgICAgIHhoci5vcGVuKG1ldGhvZCwgYWRkcmVzcywgdHJ1ZSk7XG4gICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQ29udGVudC1UeXBlXCIsIFwiYXBwbGljYXRpb24vanNvblwiKTtcbiAgICAgICAgbGV0IHRva2VuID0gbnVsbDtcbiAgICAgICAgaWYgKCF0b2tlbiAmJiBjYy5zeXMuaXNCcm93c2VyKSB7XG4gICAgICAgICAgICBjb25zdCBjb29raWVzID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCc7Jyk7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvb2tpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb29raWUgPSBjb29raWVzW2ldLnRyaW0oKTtcbiAgICAgICAgICAgICAgICBpZiAoY29va2llLnN0YXJ0c1dpdGgoJ3VzZXJUb2tlbj0nKSkge1xuICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IGNvb2tpZS5zdWJzdHJpbmcoJ3VzZXJUb2tlbj0nLmxlbmd0aCwgY29va2llLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBJZiB0b2tlbiBleGlzdHMsIGFkZCBpdCB0byBhIGN1c3RvbSBoZWFkZXJcbiAgICAgICAgaWYgKHRva2VuKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyh0b2tlbiwgXCJ0b2tlblwiKTtcbiAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQXV0aG9yaXphdGlvblwiLCBcIkJlYXJlciBcIiArIHRva2VuKTtcbiAgICAgICAgICAgIC8vIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQ29va2llXCIsIGB1c2VyVG9rZW49JHt0b2tlbn1gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobWV0aG9kID09PSBcIlBPU1RcIiB8fCBtZXRob2QgPT09IFwiUFVUXCIpIHtcbiAgICAgICAgICAgIHhoci5zZW5kKEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICAgICAgfSBlbHNlIGlmIChtZXRob2QgPT09IFwiR0VUXCIpIHtcbiAgICAgICAgICAgIHhoci5zZW5kKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG5cblxuICAgIFxuICAgIC8vIFdJTEwgdXNlIHRoZSBmb2xsb3dpbmcgY29kZSBsYXRlciB0byBjaGVjayBpZiB0aGUgc2FtZSBhcGkgaXMgcmVxdWVzdCB1bnRpbGwgd2UgZ2V0cyBpdHMgcmVzcG9uc2VcbiAgICAvLyAvKipcbiAgICAvLyB1cGRhdGVUcmFja2VyOiBmdW5jdGlvbiAodmFsLCBrZXksIHNob3dMb2FkaW5nKSB7XG4gICAgLy8gICAgIHZhciBpbmNyID0gdmFsID8gKzEgOiAtMTtcbiAgICAvLyAgICAgdGhpcy50cmFja2VyQ291bnQgPSB0aGlzLnRyYWNrZXJDb3VudCArIGluY3I7XG4gICAgLy8gICAgIHZhciBpc0FjdGl2ZSA9IHZhbCAmJiBzaG93TG9hZGluZztcbiAgICAvLyAgICAgaWYoIXRoaXMubG9hZGluZy5hY3RpdmUgJiYgc2hvd0xvYWRpbmcpe1xuICAgIC8vICAgICAgICAgdGhpcy5sb2FkaW5nLmFjdGl2ZSA9IHRydWU7IFxuICAgIC8vICAgICB9ZWxzZSBpZih0aGlzLmxvYWRpbmcuYWN0aXZlICYmICFzaG93TG9hZGluZykge1xuICAgIC8vICAgICAgICAgdGhpcy5sb2FkaW5nLmFjdGl2ZSA9IGZhbHNlO1xuICAgIC8vICAgICB9XG4gICAgLy8gICAgIC8vdGhpcy5sb2FkaW5nLmFjdGl2ZSA9IHZhbCAmJiBzaG93TG9hZGluZztcbiAgICAvLyAgICAgdGhpcy50cmFja2VyW2tleV0gPSB2YWw7XG4gICAgLy8gfSxcblxufSk7Il19